<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>XP Visualizer Player</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      overflow: hidden;
      height: 100%;
    }

    canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
      background: black;
    }

    .xp-player {
      position: absolute;
      top: 100px; left: 100px;
      width: 300px;
      background: #e4e4e4;
      border: 2px solid #000;
      font-family: Tahoma, sans-serif;
      box-shadow: 4px 4px rgba(0,0,0,0.5);
    }

    .title-bar {
      background: linear-gradient(to right, #0a64ad, #1c87e4);
      color: white;
      padding: 4px 10px;
      cursor: move;
      font-weight: bold;
    }

    .controls {
      padding: 10px;
      display: flex;
      justify-content: space-around;
    }

    button {
      font-size: 12px;
      padding: 5px 10px;
      border: 1px solid #999;
      background: #ddd;
      box-shadow: inset 1px 1px #fff, inset -1px -1px #aaa;
      cursor: pointer;
    }

    .track-name {
      padding: 5px 10px;
      font-size: 12px;
    }
  </style>
</head>
<body>

<canvas id="visualizer"></canvas>

<div class="xp-player" id="playerWindow">
  <div class="title-bar" id="titleBar">XP Audio Player</div>
  <div class="track-name" id="trackName">Track: (None)</div>
  <div class="controls">
    <button id="prev">‚èÆ</button>
    <button id="play">‚ñ∂Ô∏è</button>
    <button id="next">‚è≠</button>
    <button id="loop">üîÅ</button>
    <button id="shuffle">üîÄ</button>
  </div>
</div>

<script>
  // --- AUDIO SETUP ---
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const analyser = audioCtx.createAnalyser();
  analyser.fftSize = 128;

  const audio = new Audio();
  const source = audioCtx.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(audioCtx.destination);

  const playlist = [
    { name: "Track 1", src: "track1.mp3" },
    { name: "Track 2", src: "track2.mp3" }
  ];
  let currentIndex = 0;
  let isLoop = false;
  let isShuffle = false;

  const playBtn = document.getElementById("play");
  const nextBtn = document.getElementById("next");
  const prevBtn = document.getElementById("prev");
  const loopBtn = document.getElementById("loop");
  const shuffleBtn = document.getElementById("shuffle");
  const trackName = document.getElementById("trackName");

  function loadTrack(index) {
    currentIndex = index;
    audio.src = playlist[index].src;
    trackName.textContent = "Track: " + playlist[index].name;
    audio.play();
    audioCtx.resume();
  }

  function nextTrack() {
    if (isShuffle) {
      loadTrack(Math.floor(Math.random() * playlist.length));
    } else {
      loadTrack((currentIndex + 1) % playlist.length);
    }
  }

  audio.onended = () => {
    if (isLoop) {
      loadTrack(currentIndex);
    } else {
      nextTrack();
    }
  };

  playBtn.onclick = () => {
    if (audio.paused) {
      audio.play(); audioCtx.resume();
      playBtn.textContent = "‚è∏";
    } else {
      audio.pause();
      playBtn.textContent = "‚ñ∂Ô∏è";
    }
  };

  nextBtn.onclick = nextTrack;
  prevBtn.onclick = () => {
    currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
    loadTrack(currentIndex);
  };

  loopBtn.onclick = () => { isLoop = !isLoop; loopBtn.style.background = isLoop ? "#8f8" : ""; };
  shuffleBtn.onclick = () => { isShuffle = !isShuffle; shuffleBtn.style.background = isShuffle ? "#8f8" : ""; };

  loadTrack(currentIndex);

  // --- VISUALIZER ---
  const canvas = document.getElementById("visualizer");
  const ctx = canvas.getContext("2d");
  const dataArray = new Uint8Array(analyser.frequencyBinCount);

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.onresize = resize;
  resize();

  function draw() {
    requestAnimationFrame(draw);
    analyser.getByteFrequencyData(dataArray);

    ctx.fillStyle = 'rgba(0, 0, 0, 0.25)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const barWidth = canvas.width / dataArray.length;
    for (let i = 0; i < dataArray.length; i++) {
      const h = dataArray[i] * 2;
      ctx.fillStyle = `rgb(${h},${100 + i*2},${255 - i*2})`;
      ctx.fillRect(i * barWidth, canvas.height - h, barWidth - 2, h);
    }
  }

  draw();

  // --- DRAGGABLE WINDOW ---
  const player = document.getElementById("playerWindow");
  const titleBar = document.getElementById("titleBar");
  let offsetX = 0, offsetY = 0, isDragging = false;

  titleBar.addEventListener("mousedown", (e) => {
    isDragging = true;
    offsetX = e.clientX - player.offsetLeft;
    offsetY = e.clientY - player.offsetTop;
  });

  document.addEventListener("mouseup", () => isDragging = false);
  document.addEventListener("mousemove", (e) => {
    if (isDragging) {
      player.style.left = (e.clientX - offsetX) + "px";
      player.style.top = (e.clientY - offsetY) + "px";
    }
  });
</script>

</body>
</html>
